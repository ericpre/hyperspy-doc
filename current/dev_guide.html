

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Developer Guide &mdash; HyperSpy 1.4.2 documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/hyperspy.ico"/>
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Credits" href="credits.html" />
    <link rel="prev" title="hyperspy.ui_registry module" href="api/hyperspy.ui_registry.html" />
 
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-25260850-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>


  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> HyperSpy
          

          
            
            <img src="_static/hyperspy_logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.4.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="user_guide/index.html">HyperSpy User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/modules.html">Full HyperSpy API Documentation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Developer Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#start-using-hyperspy-and-understand-it">1. Start using HyperSpy and understand it</a></li>
<li class="toctree-l2"><a class="reference internal" href="#got-a-problem-ask">2. Got a problem? – ask!</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pick-your-battles">3. Pick your battles</a></li>
<li class="toctree-l2"><a class="reference internal" href="#get-good-habits">4. Get good habits</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#use-git-and-work-in-manageable-branches">Use git and work in manageable branches</a></li>
<li class="toctree-l3"><a class="reference internal" href="#get-the-style-right">Get the style right</a></li>
<li class="toctree-l3"><a class="reference internal" href="#write-tests">Write tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="#plot-testing">Plot testing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#write-documentation">Write documentation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#make-your-contribution">5. Make your contribution</a></li>
<li class="toctree-l2"><a class="reference internal" href="#contributing-cython-code">6. Contributing cython code</a></li>
<li class="toctree-l2"><a class="reference internal" href="#adding-new-methods">7. Adding new methods</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="credits.html">Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="citing.html">Citing HyperSpy</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">HyperSpy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Developer Guide</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/dev_guide.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <p>﻿
.. _dev_guide-label:</p>
<div class="section" id="developer-guide">
<h1>Developer Guide<a class="headerlink" href="#developer-guide" title="Permalink to this headline">¶</a></h1>
<p>This 6-step guide is intended to give people who want to start contributing
their own tools to HyperSpy a foothold to kick-start the process. This is
also the way to start if you ultimately hope to become a member of the
developer team.</p>
<p>We anticipate that many potential contributors and developers will be
scientists who may have a lot to offer in terms of expert knowledge but may
have little experience when it comes to working on a reasonably large
open-source project like HyperSpy. This guide is aimed at you - helping to
reduce the barrier to make a contribution.</p>
<p>Before you start you should decide which platform (i.e. Linux, Windows, or Mac)
you are going to work in. All are possible and the advice below is the same
it’s only the specifics that change.</p>
<div class="section" id="start-using-hyperspy-and-understand-it">
<h2>1. Start using HyperSpy and understand it<a class="headerlink" href="#start-using-hyperspy-and-understand-it" title="Permalink to this headline">¶</a></h2>
<p>The best way to start understanding how HyperSpy works and to build a broad
overview of the code as it stands is to use it – so what are you waiting for?
<a class="reference external" href="http://hyperspy.org/hyperspy-doc/current/user_guide/install.html">Install HyperSpy</a>.</p>
<p>The user-guide also provides a good overview of all the parts of the code that
are currently implemented as well as much information about how everything
works – so read it well:
<a class="reference external" href="http://www.hyperspy.org/hyperspy-doc/current/index.html">HyperSpy User-Guide</a>.</p>
<p>For developing the code the home of HyperSpy is on github and you’ll see that
a lot of this guide boils down to using that platform well. so visit the
following link and poke around the code, issues, and pull requests: <a class="reference external" href="https://github.com/hyperspy/hyperspy">HyperSpy
on Github</a>.</p>
<p>It’s probably also worth visiting the <a class="reference external" href="https://github.com/">Github</a> home page
and going through the <a class="reference external" href="https://help.github.com/categories/bootcamp/">“boot camp”</a> to get a feel for the terminology.</p>
<p>In brief, to give you a hint on the terminology to search for, the contribution
pattern is:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Setup git/github if you don’t have it.</p></li>
<li><p>Fork HyperSpy on github.</p></li>
<li><p>Checkout your fork on your local machine.</p></li>
<li><p>Create a new branch locally where you will make your changes.</p></li>
<li><p>Push the local changes to your own github fork.</p></li>
<li><p>Create a pull request (PR) to the official HyperSpy repository.</p></li>
</ol>
</div></blockquote>
<p>Note: You cannot mess up the main HyperSpy project unless you have been
promoted to write access and the dev-team. So when you’re starting out be
confident to play, get it wrong, and if it all goes wrong you can always get
a fresh install of HyperSpy!!</p>
<p>PS: If you choose to develop in Windows/Mac you may find <a class="reference external" href="https://desktop.github.com">Github Desktop</a> useful.</p>
</div>
<div class="section" id="got-a-problem-ask">
<h2>2. Got a problem? – ask!<a class="headerlink" href="#got-a-problem-ask" title="Permalink to this headline">¶</a></h2>
<p>Open source projects are all about community - we put in much effort to make
good tools available to all and most people are happy to help others start out.
Everyone had to start at some point and the philosophy of these projects
centres around the fact that we can do better by working together.</p>
<p>Much of the conversation happens in ‘public’ via online platforms. The main two
forums used by HyperSpy developers are:</p>
<p><a class="reference external" href="https://gitter.im/hyperspy/hyperspy">Gitter</a> – where we host a live
chat-room in which people can ask questions and discuss things in a relatively
informal way.</p>
<p><a class="reference external" href="https://github.com/hyperspy/hyperspy/issues">Github</a> – the main repository
for the source code also enables issues to be raised in a way that means
they’re logged until dealt with. This is also a good place to make a proposal
for some new feature or tool that you want to work on.</p>
</div>
<div class="section" id="pick-your-battles">
<h2>3. Pick your battles<a class="headerlink" href="#pick-your-battles" title="Permalink to this headline">¶</a></h2>
<p>Work out what you want to contribute and break it down in to manageable chunks.</p>
<p>You may have a very clear idea of what you want to contribute but if you’re
not sure where to start you can always look through the issues and pull
requests on the <a class="reference external" href="https://github.com/hyperspy/hyperspy/">GitHub Page</a>.
You’ll find that there are many known areas for development in the issues
and a number of pull-requests are part finished projects just sitting there
waiting for a keen new contributor to come and learn by finishing.</p>
<p>When you’ve decided what you’re going to work on - let people know using the
online forums!</p>
<p>It may be that someone else is doing something similar and can help, it’s also
good to make sure that those working on related projects are pulling in the
same direction.</p>
</div>
<div class="section" id="get-good-habits">
<h2>4. Get good habits<a class="headerlink" href="#get-good-habits" title="Permalink to this headline">¶</a></h2>
<p>There are 3 key points to get right when starting out as a contributor - keep
work separated in manageable sections, make sure that your code style is good,
and bear in mind that every new function you write will need a test and user
documentation!</p>
<div class="section" id="use-git-and-work-in-manageable-branches">
<h3>Use git and work in manageable branches<a class="headerlink" href="#use-git-and-work-in-manageable-branches" title="Permalink to this headline">¶</a></h3>
<p>By now you’ll have had a look around GitHub - but why’s it so important?</p>
<p>Well GitHub is the public forum in which we manage and discuss development of
the code. More importantly, it enables every developer to utilise Git which is
an open source “version control” system that you can use on your laptop or
desktop. By version control we mean that you can separate out your contribution
to the code into many versions (called branches) and switch between them
easily. Later you can choose which version you want to have integrated into
HyperSpy.</p>
<p>You can learn all about Git <a class="reference external" href="http://www.git-scm.com/about">here</a>!</p>
<p>The most important thing for you to do is to separate your contributions so
that each branch is small advancement on the “master” code or on another
branch. In the end each branch will have to be checked and reviewed by
someone else before it can be included - so if it’s too big, you will be
asked to split it up!</p>
<p>For personal use, before integrating things into the main HyperSpy code, you
may want to use a few branches together. You can do that but just make sure
each new thing has it’s own branch! You can merge some together for your
personal use.</p>
<p>Diagrammatically you should be aiming for something like this:</p>
<div class="figure align-default">
<img alt="_images/branching_schematic.png" src="_images/branching_schematic.png" />
</div>
</div>
<div class="section" id="get-the-style-right">
<h3>Get the style right<a class="headerlink" href="#get-the-style-right" title="Permalink to this headline">¶</a></h3>
<p>HyperSpy follows the Style Guide for Python Code - these are just some rules
for consistency that you can read all about in the <a class="reference external" href="https://www.python.org/dev/peps/pep-0008/">Python Style Guide</a>.</p>
<p>You can check your code with the <a class="reference external" href="https://pypi.python.org/pypi/pep8">pep8 Code Checker</a>.</p>
</div>
<div class="section" id="write-tests">
<span id="tests-label"></span><h3>Write tests<a class="headerlink" href="#write-tests" title="Permalink to this headline">¶</a></h3>
<p>Every new function that is written in to HyperSpy needs to be tested and
documented.</p>
<p>Tests are short functions found in hyperspy/tests that call your functions
under some known conditions and check the outputs against known values. They
should depend on as few other features as possible so that when they break
we know exactly what caused it. Ideally, the tests should be written at the
same time than the code itself, as they are very convenient to run to check
outputs when coding. Writing tests can seem laborious but you’ll probably
soon find that they’re very important as they force you to sanity check all
you do.</p>
<p>HyperSpy uses the <a class="reference external" href="http://doc.pytest.org/">py.test</a> library for testing. The
tests reside in the <code class="docutils literal notranslate"><span class="pre">hyperspy.tests</span></code> module. To run them:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>py.test --pyargs hyperspy
</pre></div>
</div>
<p>Or, from HyperSpy’s project folder simply:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>py.test
</pre></div>
</div>
<p>Useful hints on testing:</p>
<ul class="simple">
<li><p>When comparing integers, it’s fine to use <code class="docutils literal notranslate"><span class="pre">==</span></code>. When comparing floats, be
sure to use <code class="docutils literal notranslate"><span class="pre">numpy.testing.assert_almost_equal()</span></code> or
<code class="docutils literal notranslate"><span class="pre">numpy.testing.assert_allclose()</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">numpy.testing.assert_equal()</span></code> is convenient to compare numpy arrays.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">hyperspy.misc.test_utils.py</span></code> contains a few useful functions for
testing.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&#64;pytest.mark.parametrize()</span></code> is a very convenient decorator to test several
parameters of the same function without having to write to much repetitive
code, which is often error-prone. See <a class="reference external" href="http://doc.pytest.org/en/latest/parametrize.html">pytest documentation for more details</a>.</p></li>
<li><p>It is good to check that the tests does not use too much of memory after
creating new tests. If you need to explicitly delete your objects and free
memory, you can do the following to release the memory associated to the
<code class="docutils literal notranslate"><span class="pre">s</span></code> object, for example:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">del</span> <span class="n">s</span>
<span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Once, you have pushed your PR to the official HyperSpy repository, it can be
useful to check the coverage of your tests using the coveralls.io check of
your PR. There should be a link to it at the bottom of your PR on the github
PR page. This service can help you to find how well your code is being tested
and exactly which part is not currently tested.</p></li>
<li><p><a class="reference external" href="https://pypi.python.org/pypi/pytest-sugar">pytest-sugar</a> can be installed
to have a nicer look and feel of py.test in the console (encoding issue have
been reported in the Windows console).</p></li>
</ul>
</div>
<div class="section" id="plot-testing">
<span id="plot-test-label"></span><h3>Plot testing<a class="headerlink" href="#plot-testing" title="Permalink to this headline">¶</a></h3>
<p>Plotting is tested using the <code class="docutils literal notranslate"><span class="pre">&#64;pytest.mark.mpl_image_compare</span></code> decorator of
the <a class="reference external" href="https://pypi.python.org/pypi/pytest-mpl">pytest mpl plugin</a>.  This
decorator uses reference images to compare with the generated output during the
tests. The references images are located in the folder defined by the argument
<code class="docutils literal notranslate"><span class="pre">baseline_dir</span></code> of the <code class="docutils literal notranslate"><span class="pre">&#64;pytest.mark.mpl_image_compare</span></code> decorator.</p>
<p>To run plotting tests, you simply need to add the option <code class="docutils literal notranslate"><span class="pre">--mpl</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pytest</span> <span class="o">--</span><span class="n">mpl</span>
</pre></div>
</div>
<p>If you don’t use the <code class="docutils literal notranslate"><span class="pre">--mpl</span></code>, the code of the tests will be executed but the
images will not be compared to the references images.</p>
<p>If you need to add or change some plots, follow the workflow below:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Write the tests using appropriate decorator such as
<code class="docutils literal notranslate"><span class="pre">&#64;pytest.mark.mpl_image_compare</span></code>.</p></li>
<li><p>If you need to generate new reference image in the folder
<code class="docutils literal notranslate"><span class="pre">plot_test_dir</span></code>, for example, run: <code class="docutils literal notranslate"><span class="pre">py.test</span>
<span class="pre">--mpl-generate-path=plot_test_dir</span></code></p></li>
<li><p>Run again the tests and this time they should pass.</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">add</span></code> to put the new file in the git repository.</p></li>
</ol>
</div></blockquote>
<p>When the plotting tests are failling, it is possible to download the figure
comparison images generated by pytest-mpl in the <a class="reference external" href="https://ci.appveyor.com/project/hyperspy/hyperspy/build/1.0.2500/job/2c2qccaktd90po2q/artifacts">artifacts tabs</a>
of the corresponding build.</p>
<dl class="simple">
<dt>The plotting tests need matplotlib &gt; 3.0.0, since small changes in the way</dt><dd><p>matplotlib generates the figure can make the tests fail.</p>
</dd>
</dl>
<p>In travis and appveyor, the matplotlib backend is set to <code class="docutils literal notranslate"><span class="pre">agg</span></code> by setting
the <code class="docutils literal notranslate"><span class="pre">MPLBACKEND</span></code> environment variable to <code class="docutils literal notranslate"><span class="pre">agg</span></code>. At the first import of
<code class="docutils literal notranslate"><span class="pre">matplotlib.pyplot</span></code>, matplotlib will look at the <code class="docutils literal notranslate"><span class="pre">MPLBACKEND</span></code> environment
variable and set accordingly the backend.</p>
<p>See <a class="reference external" href="https://pypi.python.org/pypi/pytest-mpl">pytest-mpl</a> for more details.</p>
</div>
<div class="section" id="write-documentation">
<h3>Write documentation<a class="headerlink" href="#write-documentation" title="Permalink to this headline">¶</a></h3>
<p>Documentation comes in two parts: docstrings and user-guide documentation.</p>
<p>Docstrings – written at the start of a function and give essential information
about how it should be used, such as which arguments can be passed to it and
what the syntax should be. The docstrings need to follow the <a class="reference external" href="https://github.com/numpy/numpy/blob/master/doc/HOWTO_DOCUMENT.rst.txt">numpy
specification</a>, as shown in <a class="reference external" href="https://github.com/numpy/numpy/blob/master/doc/example.py">this example</a>.</p>
<p>User-guide documentation – A description of the functionality of the code and
how to use it with examples and links to the relevant code.</p>
<p>When writing both the docstrings and user guide documentation, it is useful to
have some kind of data which the users can use themselves. Artificial
datasets for this purpose can be found in <cite>hyperspy.datasets.artificial_data</cite>.</p>
<p>Build the documentation – To check the output of what you wrote, you can build
the documentation by running the <code class="docutils literal notranslate"><span class="pre">make</span></code> command in the <code class="docutils literal notranslate"><span class="pre">hyperspy/doc</span></code>
directory. For example <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">html</span></code> will build the whole documentation in
html format. See the make command documentation for more details.</p>
<p>To install the documentation dependencies, run either</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ conda install hyperspy-dev
</pre></div>
</div>
</div></blockquote>
<p>or</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pip install hyperspy<span class="o">[</span>build-doc<span class="o">]</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="make-your-contribution">
<h2>5. Make your contribution<a class="headerlink" href="#make-your-contribution" title="Permalink to this headline">¶</a></h2>
<p>When you’ve got a branch that’s ready to be incorporated in to the main code of
HyperSpy – make a pull request on GitHub and wait for it to be reviewed and
discussed.</p>
</div>
<div class="section" id="contributing-cython-code">
<h2>6. Contributing cython code<a class="headerlink" href="#contributing-cython-code" title="Permalink to this headline">¶</a></h2>
<p>Python is not the fastest language, and can be particularly slow in loops.
Performance can sometimes be significantly improved by implementing optional
cython code alongside the pure Python versions. While developing cython code,
make use of the official cython recommendations (<a class="reference external" href="http://docs.cython.org/">http://docs.cython.org/</a>).  Add
your cython extensions to the setup.py, in the existing list of
<code class="docutils literal notranslate"><span class="pre">raw_extensions</span></code>.</p>
<p>Unlike the cython recommendation, the cythonized .c or .cpp files are not
welcome in the git source repository (except original c or c++ files), since
they are typically quite large. Cythonization will take place during Travis
CI and Appveyor building. The cythonized code will be generated and included
in source or binary distributions for end users. To help troubleshoot
potential deprecation with future cython releases, add a comment with in the
header of your .pyx files with the cython version. If cython is present in
the build environment and any cythonized c/c++ file is missing, then setup
.py tries to cythonize all extensions automatically.</p>
<p>To make the development easier the new command <code class="docutils literal notranslate"><span class="pre">recythonize</span></code> has been added
to setup.py.  It can be used in conjunction with other default commands.  For
example <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">recythonize</span> <span class="pre">build_ext</span> <span class="pre">--inplace</span></code> will recythonize
all changed (and described in setup.py!) cython code and compile.</p>
<p>When developing on git branches, the first time you call setup.py in
conjunction with or without any other command - it will generate a
post-checkout hook, which will include a potential cythonization and
compilation product list (.c/.cpp/.so/.pyd). With your next <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">checkout</span></code>
the hook will remove them and automatically run <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">build_ext</span>
<span class="pre">--inplace</span></code> to cythonize and compile the code if available.  If an older
version of HyperSpy (&lt;= 0.8.4.x) is checked out this should have no side
effects.</p>
<p>If another custom post-checkout hook is detected on PR, then setup.py tries to
append or update the relevant part. To prevent unwanted hook generation or
update you can create the empty file <code class="docutils literal notranslate"><span class="pre">.hook_ignore</span></code> in source directory (same
level as setup.py).</p>
</div>
<div class="section" id="adding-new-methods">
<h2>7. Adding new methods<a class="headerlink" href="#adding-new-methods" title="Permalink to this headline">¶</a></h2>
<p>With the addition of the <code class="docutils literal notranslate"><span class="pre">LazySignal</span></code> class and its derivatives, adding
methods that operate on the data becomes slightly more complicated. However, we
have attempted to streamline it as much as possible. <code class="docutils literal notranslate"><span class="pre">LazySignals</span></code> use
<code class="docutils literal notranslate"><span class="pre">dask.array.Array</span></code> for the <code class="docutils literal notranslate"><span class="pre">data</span></code> field instead of the usual
<code class="docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>. The full documentation is available
<a class="reference external" href="https://dask.readthedocs.io/en/latest/array.html">here</a>. While interfaces of
the two arrays are indeed almost identical, the most important differences are
(<code class="docutils literal notranslate"><span class="pre">da</span></code> being <code class="docutils literal notranslate"><span class="pre">dask.array.Array</span></code> in the examples):</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>Dask arrays are immutable</strong>: <code class="docutils literal notranslate"><span class="pre">da[3]</span> <span class="pre">=</span> <span class="pre">2</span></code> does not work. <code class="docutils literal notranslate"><span class="pre">da</span> <span class="pre">+=</span> <span class="pre">2</span></code>
does, but it’s actually a new object – might as well use <code class="docutils literal notranslate"><span class="pre">da</span> <span class="pre">=</span> <span class="pre">da</span> <span class="pre">+</span> <span class="pre">2</span></code>
for a better distinction.</p></li>
<li><p><strong>Unknown shapes are problematic</strong>: <code class="docutils literal notranslate"><span class="pre">res</span> <span class="pre">=</span> <span class="pre">da[da&gt;0.3]</span></code> works, but the
shape of the result depends on the values and cannot be inferred without
execution. Hence few operations can be run on <code class="docutils literal notranslate"><span class="pre">res</span></code> lazily, and it should
be avoided if possible.</p></li>
</ul>
</div></blockquote>
<p>The easiest way to add new methods that work both with arbitrary navigation
dimensions and <code class="docutils literal notranslate"><span class="pre">LazySignals</span></code> is by using the <code class="docutils literal notranslate"><span class="pre">map</span></code> (or, for more control,
<code class="docutils literal notranslate"><span class="pre">_map_all</span></code> or <code class="docutils literal notranslate"><span class="pre">_map_iterate</span></code>) method to map your function <code class="docutils literal notranslate"><span class="pre">func</span></code> across
all “navigation pixels” (e.g. spectra in a spectrum-image). <code class="docutils literal notranslate"><span class="pre">map</span></code> methods
will run the function on all pixels efficiently and put the results back in the
correct order. <code class="docutils literal notranslate"><span class="pre">func</span></code> is not constrained by <code class="docutils literal notranslate"><span class="pre">dask</span></code> and can use whatever
code (assignment, etc.) you wish.</p>
<p>If the new method cannot be coerced into a shape suitable <code class="docutils literal notranslate"><span class="pre">map</span></code>, separate
cases for lazy signals will have to be written. If a function operates on
arbitrary-sized arrays and the shape of the output can be known before calling,
<code class="docutils literal notranslate"><span class="pre">da.map_blocks</span></code> and <code class="docutils literal notranslate"><span class="pre">da.map_overlap</span></code> are efficient and flexible.</p>
<p>Finally, in addition to <code class="docutils literal notranslate"><span class="pre">_iterate_signal</span></code> that is available to all HyperSpy
signals, lazy counterparts also have <code class="docutils literal notranslate"><span class="pre">_block_iterator</span></code> method that supports
signal and navigation masking and yields (returns on subsequent calls) the
underlying dask blocks as numpy arrays. It is important to note that stacking
all (flat) blocks and reshaping the result into the initial data shape will not
result in identical arrays. For illustration it is best to see the <a class="reference external" href="https://dask.readthedocs.io/en/latest/array.html">dask
documentation</a>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="credits.html" class="btn btn-neutral float-right" title="Credits" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="api/hyperspy.ui_registry.html" class="btn btn-neutral" title="hyperspy.ui_registry module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2011-2018, The HyperSpy development team

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script type="text/javascript" src="_static/copybutton.js"></script>
    

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>